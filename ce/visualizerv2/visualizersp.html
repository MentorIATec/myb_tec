<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Eventos - Consejer√≠a Emocional</title>
    <style>
        :root {
            --color-primary: #0072CE;
            --color-secondary: #FF5800;
            --color-light-bg: #f5f9ff;
            --color-text-dark: #333;
            --color-curso: #0072CE;
            --color-taller: #FF5800;
            --color-grupo: #9C27B0;
            --color-activacion: #009688;
            --color-evento: #FF9800;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f8f8;
            color: var(--color-text-dark);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        h1 {
            color: var(--color-primary);
            font-size: 24px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        
        .nav-button {
            background-color: var(--color-primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        
        /* Calendario */
        .calendar-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .calendar-header {
            background: var(--color-primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .month-display {
            font-size: 18px;
            font-weight: 600;
        }
        
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        
        .calendar-nav button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .calendar-nav button:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .days-of-week {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            background: #f0f5ff;
            padding: 10px 0;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            color: #666;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
        }
        
        .day-cell {
            border-right: 1px solid #eee;
            border-bottom: 1px solid #eee;
            min-height: 100px;
            padding: 8px;
            position: relative;
        }
        
        .day-cell:nth-child(5n) {
            border-right: none;
        }
        
        .day-number {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
            text-align: right;
        }
        
        .current-day .day-number {
            color: var(--color-secondary);
            font-weight: 700;
        }
        
        .day-events {
            display: flex;
            flex-direction: column;
            gap: 2px;
            margin-top: 10px;
        }
        
        .event-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 3px;
        }
        
        .event-dot {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        
        .event-dot.curso { background-color: var(--color-curso); }
        .event-dot.taller { background-color: var(--color-taller); }
        .event-dot.grupo { background-color: var(--color-grupo); }
        .event-dot.activacion { background-color: var(--color-activacion); }
        .event-dot.evento { background-color: var(--color-evento); }
        
        .day-event {
            font-size: 11px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 2px 4px;
            border-radius: 2px;
            margin-bottom: 2px;
            cursor: pointer;
        }
        
        .day-event.curso { background-color: var(--color-curso); color: white; }
        .day-event.taller { background-color: var(--color-taller); color: white; }
        .day-event.grupo { background-color: var(--color-grupo); color: white; }
        .day-event.activacion { background-color: var(--color-activacion); color: white; }
        .day-event.evento { background-color: var(--color-evento); color: white; }
        
        /* Eventos Lista */
        .events-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .events-header {
            background: var(--color-primary);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .events-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .events-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
        }
        
        .events-list {
            padding: 15px;
        }
        
        .event-card {
            border-left: 4px solid var(--color-primary);
            padding: 12px 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .event-card:last-child {
            margin-bottom: 0;
        }
        
        .event-card.curso { border-left-color: var(--color-curso); }
        .event-card.taller { border-left-color: var(--color-taller); }
        .event-card.grupo { border-left-color: var(--color-grupo); }
        .event-card.activacion { border-left-color: var(--color-activacion); }
        .event-card.evento { border-left-color: var(--color-evento); }
        
        .event-card-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .event-card.curso .event-card-title { color: var(--color-curso); }
        .event-card.taller .event-card-title { color: var(--color-taller); }
        .event-card.grupo .event-card-title { color: var(--color-grupo); }
        .event-card.activacion .event-card-title { color: var(--color-activacion); }
        .event-card.evento .event-card-title { color: var(--color-evento); }
        
        .event-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            background-color: var(--color-primary);
            color: white;
            display: inline-block;
            text-transform: uppercase;
            font-weight: 500;
        }
        
        .event-badge.curso { background-color: var(--color-curso); }
        .event-badge.taller { background-color: var(--color-taller); }
        .event-badge.grupo { background-color: var(--color-grupo); }
        .event-badge.activacion { background-color: var(--color-activacion); }
        .event-badge.evento { background-color: var(--color-evento); }
        
        .event-info {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 5px 0;
            font-size: 13px;
            color: #555;
        }
        
        .event-date, .event-time, .event-location {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .event-actions {
            margin-top: 8px;
            display: flex;
            gap: 10px;
        }
        
        .event-btn {
            font-size: 12px;
            padding: 5px 10px;
            border-radius: 4px;
            border: none;
            background-color: var(--color-primary);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            text-decoration: none;
        }
        
        .event-btn:hover {
            opacity: 0.9;
        }
        
        .event-btn.register {
            background-color: var(--color-secondary);
        }
        
        /* Leyenda */
        .legend-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            color: #555;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .legend-color.curso { background-color: var(--color-curso); }
        .legend-color.taller { background-color: var(--color-taller); }
        .legend-color.grupo { background-color: var(--color-grupo); }
        .legend-color.activacion { background-color: var(--color-activacion); }
        .legend-color.evento { background-color: var(--color-evento); }
        
        /* Modal para mostrar eventos */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--color-primary);
            padding-right: 30px;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 20px;
            cursor: pointer;
            background: none;
            border: none;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background-color: #f0f0f0;
        }
        
        .modal-body {
            padding: 15px 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .day-cell {
                min-height: 80px;
                padding: 5px;
            }
            
            .day-event {
                font-size: 9px;
            }
        }
        
        @media (max-width: 480px) {
            .day-cell {
                min-height: 60px;
                padding: 3px;
            }
            
            .day-number {
                font-size: 12px;
            }
            
            .day-event {
                font-size: 8px;
                margin-bottom: 1px;
            }
            
            .days-of-week {
                font-size: 12px;
            }
            
            .calendar-header, .events-header {
                padding: 10px;
            }
            
            .month-display, .events-title {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align: right; margin-bottom: 20px;">
            <button class="nav-button" id="btn-today">Hoy</button>
        </div>
        
        <!-- Calendario -->
        <div class="calendar-container">
            <div class="calendar-header">
                <div class="month-display" id="month-display">Marzo 2025</div>
                <div class="calendar-nav">
                    <button id="prev-month"><i class="fa fa-chevron-left"></i></button>
                    <button id="next-month"><i class="fa fa-chevron-right"></i></button>
                </div>
            </div>
            
            <div class="days-of-week">
                <div>LUN</div>
                <div>MAR</div>
                <div>MI√â</div>
                <div>JUE</div>
                <div>VIE</div>
            </div>
            
            <div class="calendar-grid" id="calendar-grid">
                <!-- Las celdas del calendario se generar√°n con JavaScript -->
            </div>
        </div>
        
        <!-- Leyenda de colores -->
        <div class="legend-container">
            <div class="legend-item">
                <div class="legend-color curso"></div>
                <span>Cursos</span>
            </div>
            <div class="legend-item">
                <div class="legend-color taller"></div>
                <span>Talleres</span>
            </div>
            <div class="legend-item">
                <div class="legend-color grupo"></div>
                <span>Grupos</span>
            </div>
            <div class="legend-item">
                <div class="legend-color activacion"></div>
                <span>Activaciones</span>
            </div>
            <div class="legend-item">
                <div class="legend-color evento"></div>
                <span>Eventos</span>
            </div>
        </div>
        
        <!-- Lista de eventos -->
        <div class="events-container">
            <div class="events-header">
                <div class="events-title">Eventos pr√≥ximos</div>
                <div class="events-count" id="events-count">0 eventos</div>
            </div>
            
            <div class="events-list" id="events-list">
                <!-- Los eventos se cargar√°n aqu√≠ din√°micamente -->
                <div style="text-align: center; padding: 20px;">
                    <div class="loading-spinner"></div>
                    <p>Cargando eventos...</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para ver detalles de los eventos -->
    <div class="modal" id="event-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Detalles del evento</h3>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- El contenido del modal se cargar√° din√°micamente -->
            </div>
        </div>
    </div>
    
    <script>
        // URL para cargar los eventos
        const eventsUrl = 'https://karenguzmn.github.io/myb_tec/ce/eventos.json';
        
        // Variables para seguimiento del estado
        let allEvents = [];
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();
        
        // Nombres de meses en espa√±ol
        const monthNames = [
            'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
        ];
        
        // Abreviaturas de meses en espa√±ol
        const monthAbbr = [
            'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
            'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'
        ];
        
        // Referencias a elementos DOM
        const calendarGrid = document.getElementById('calendar-grid');
        const monthDisplay = document.getElementById('month-display');
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const todayBtn = document.getElementById('btn-today');
        const eventsList = document.getElementById('events-list');
        const eventsCount = document.getElementById('events-count');
        const eventModal = document.getElementById('event-modal');
        const modalClose = document.getElementById('modal-close');
        const modalTitle = document.getElementById('modal-title');
        const modalBody = document.getElementById('modal-body');
        
        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            // Cargar eventos
            fetchEvents();
            
            // Configurar listeners
            prevMonthBtn.addEventListener('click', goToPrevMonth);
            nextMonthBtn.addEventListener('click', goToNextMonth);
            todayBtn.addEventListener('click', goToToday);
            modalClose.addEventListener('click', closeModal);
            
            // Cerrar modal al hacer clic fuera o con ESC
            eventModal.addEventListener('click', (e) => {
                if (e.target === eventModal) closeModal();
            });
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') closeModal();
            });
        });
        
        // Cargar eventos desde JSON
        function fetchEvents() {
            fetch(eventsUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Procesar eventos
                    allEvents = data.eventos.map(event => {
                        return {
                            ...event,
                            fechaInicio: parseDate(event.fechaInicio),
                            fechaFin: parseDate(event.fechaFin || event.fechaInicio),
                            categoria: normalizeCategory(event.categoria)
                        };
                    });
                    
                    // Generar calendario
                    generateCalendar();
                    
                    // Mostrar eventos pr√≥ximos
                    showUpcomingEvents();
                })
                .catch(error => {
                    console.error('Error fetching events:', error);
                    calendarGrid.innerHTML = `<div style="grid-column: 1/-1; padding: 20px; text-align: center;">Error al cargar eventos. Por favor, intenta de nuevo m√°s tarde.</div>`;
                    eventsList.innerHTML = `<div style="padding: 20px; text-align: center;">Error al cargar eventos. Por favor, intenta de nuevo m√°s tarde.</div>`;
                });
        }
        
        // Parsear fecha desde formato DD/MM/YYYY
        function parseDate(dateStr) {
            if (!dateStr) return null;
            
            // Si ya es un objeto Date, devolverlo
            if (dateStr instanceof Date) return dateStr;
            
            try {
                const parts = dateStr.split('/');
                
                if (parts.length === 3) {
                    // Formato DD/MM/YYYY
                    const day = parseInt(parts[0], 10);
                    const month = parseInt(parts[1], 10) - 1; // Meses van de 0-11 en JS
                    const year = parseInt(parts[2], 10);
                    
                    return new Date(year, month, day);
                }
                
                // Intentar con formato de fecha normal
                return new Date(dateStr);
            } catch (error) {
                console.error('Error parsing date:', dateStr, error);
                return null;
            }
        }
        
        // Normalizar categor√≠a
        function normalizeCategory(category) {
            if (!category) return 'otro';
            
            const cat = category.toLowerCase();
            
            if (cat.includes('taller')) return 'taller';
            if (cat.includes('curso')) return 'curso';
            if (cat.includes('grupo')) return 'grupo';
            if (cat.includes('activacion') || cat.includes('activaci√≥n')) return 'activacion';
            if (cat.includes('evento')) return 'evento';
            
            return 'otro';
        }
        
        // Generar el calendario
        function generateCalendar() {
            // Limpiar calendario
            calendarGrid.innerHTML = '';
            
            // Actualizar t√≠tulo del mes
            monthDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Obtener primer d√≠a del mes (1-31)
            const firstDay = new Date(currentYear, currentMonth, 1);
            
            // Obtener el d√≠a de la semana (0: Domingo, 1: Lunes, ..., 6: S√°bado)
            const firstWeekday = firstDay.getDay();
            
            // Ajustar para que la semana comience en lunes (0: Lunes, ..., 6: Domingo)
            const firstWeekdayAdjusted = firstWeekday === 0 ? 6 : firstWeekday - 1;
            
            // √öltimo d√≠a del mes
            const lastDay = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // √öltimo d√≠a del mes anterior
            const prevMonthLastDay = new Date(currentYear, currentMonth, 0).getDate();
            
            // D√≠a actual
            const today = new Date();
            
            // No mostrar d√≠as del mes anterior
            
            // D√≠as del mes actual
            for (let day = 1; day <= lastDay; day++) {
                const date = new Date(currentYear, currentMonth, day);
                
                // Solo mostrar d√≠as de lunes a viernes
                if (date.getDay() > 0 && date.getDay() < 6) {
                    createDayCell(date, false);
                }
            }
            
            // No mostrar d√≠as del mes siguiente
        }
        
        // Crear celda de d√≠a
        function createDayCell(date, isOtherMonth) {
            const day = date.getDate();
            const isToday = isSameDay(date, new Date());
            
            // Crear celda
            const cell = document.createElement('div');
            cell.className = 'day-cell';
            if (isOtherMonth) cell.classList.add('other-month');
            if (isToday) cell.classList.add('current-day');
            
            // Agregar atributo data-date para facilitar el manejo de eventos
            cell.setAttribute('data-date', formatDateForAttribute(date));
            
            // N√∫mero del d√≠a
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = day;
            
            // Si es de otro mes, agregar indicador de mes
            if (isOtherMonth) {
                const monthIndicator = document.createElement('span');
                monthIndicator.style.fontSize = '10px';
                monthIndicator.style.marginLeft = '3px';
                monthIndicator.style.color = '#999';
                monthIndicator.textContent = monthAbbr[date.getMonth()];
                dayNumber.appendChild(monthIndicator);
            }
            
            cell.appendChild(dayNumber);
            
            // Buscar eventos para este d√≠a
            const eventsForDay = getEventsForDay(date);
            
            if (eventsForDay.length > 0) {
                const dayEvents = document.createElement('div');
                dayEvents.className = 'day-events';
                
                // Agrupar eventos por categor√≠a
                const eventsByCategory = {};
                
                eventsForDay.forEach(event => {
                    if (!eventsByCategory[event.categoria]) {
                        eventsByCategory[event.categoria] = [];
                    }
                    eventsByCategory[event.categoria].push(event);
                });
                
                // Mostrar solo los indicadores de eventos (puntos de colores)
                for (const category in eventsByCategory) {
                    const count = eventsByCategory[category].length;
                    
                    const eventIndicator = document.createElement('div');
                    eventIndicator.className = 'day-event ' + category;
                    eventIndicator.style.textAlign = 'center';
                    eventIndicator.textContent = '‚Ä¢';
                    eventIndicator.title = `${count} ${category}${count > 1 ? 's' : ''}`;
                    
                    dayEvents.appendChild(eventIndicator);
                }
                
                cell.appendChild(dayEvents);
                
                // Agregar evento de clic para mostrar todos los eventos del d√≠a
                cell.addEventListener('click', () => showDayEvents(date, eventsForDay));
            }
            
            calendarGrid.appendChild(cell);
        }
        
        // Obtener eventos para un d√≠a espec√≠fico
        function getEventsForDay(date) {
            if (!allEvents || !date) return [];
            
            return allEvents.filter(event => {
                // Eventos sin fecha no se muestran
                if (!event.fechaInicio) return false;
                
                // Si el evento es del mismo d√≠a
                if (isSameDay(event.fechaInicio, date)) return true;
                
                // Si el evento tiene fecha de fin y la fecha est√° en el rango
                if (event.fechaFin && 
                    date >= event.fechaInicio && 
                    date <= event.fechaFin) {
                    return true;
                }
                
                return false;
            });
        }
        
        // Verificar si dos fechas son el mismo d√≠a
        function isSameDay(date1, date2) {
            if (!date1 || !date2) return false;
            
            return date1.getDate() === date2.getDate() &&
                   date1.getMonth() === date2.getMonth() &&
                   date1.getFullYear() === date2.getFullYear();
        }
        
        // Mostrar eventos pr√≥ximos
        function showUpcomingEvents() {
            // Limpiar lista
            eventsList.innerHTML = '';
            
            // Obtener fecha actual (inicio del d√≠a)
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Filtrar eventos futuros
            const upcomingEvents = allEvents.filter(event => {
                if (!event.fechaInicio) return false;
                return event.fechaInicio >= today;
            });
            
            // Ordenar por fecha
            upcomingEvents.sort((a, b) => {
                if (!a.fechaInicio || !b.fechaInicio) return 0;
                return a.fechaInicio - b.fechaInicio;
            });
            
            // Actualizar contador
            eventsCount.textContent = `${upcomingEvents.length} eventos`;
            
            // Si no hay eventos pr√≥ximos
            if (upcomingEvents.length === 0) {
                eventsList.innerHTML = '<div style="text-align:center; padding:20px; color:#666;">No hay eventos pr√≥ximos programados.</div>';
                return;
            }
            
            // Mostrar los primeros 5 eventos pr√≥ximos
            const eventsToShow = upcomingEvents.slice(0, 5);
            
            eventsToShow.forEach(event => {
                eventsList.appendChild(createEventCard(event));
            });
        }
        
        // Crear tarjeta de evento
        function createEventCard(event) {
            const card = document.createElement('div');
            card.className = `event-card ${event.categoria}`;
            
            // Fecha formateada
            const formattedDate = formatDate(event.fechaInicio);
            
            // T√≠tulo y badge
            const titleContainer = document.createElement('div');
            titleContainer.className = 'event-card-title';
            
            const title = document.createElement('span');
            title.textContent = event.titulo;
            
            const badge = document.createElement('span');
            badge.className = `event-badge ${event.categoria}`;
            badge.textContent = capitalizeFirstLetter(event.categoria);
            
            titleContainer.appendChild(title);
            titleContainer.appendChild(badge);
            
            // Informaci√≥n del evento
            const eventInfo = document.createElement('div');
            eventInfo.className = 'event-info';
            
            const dateInfo = document.createElement('div');
            dateInfo.className = 'event-date';
            dateInfo.innerHTML = `<i>üìÖ</i> ${formattedDate}`;
            
            const timeInfo = document.createElement('div');
            timeInfo.className = 'event-time';
            timeInfo.innerHTML = `<i>‚è±Ô∏è</i> ${event.horario || 'Horario por definir'}`;
            
            const locationInfo = document.createElement('div');
            locationInfo.className = 'event-location';
            locationInfo.innerHTML = `<i>üìç</i> ${event.ubicacion || event.ubicaci√≥n || 'Ubicaci√≥n por definir'}`;
            
            eventInfo.appendChild(dateInfo);
            eventInfo.appendChild(timeInfo);
            eventInfo.appendChild(locationInfo);
            
            // Acciones
            const actions = document.createElement('div');
            actions.className = 'event-actions';
            
            // Bot√≥n de registro (si tiene URL)
            if (event.urlRegistro && event.urlRegistro !== '#') {
                const registerBtn = document.createElement('a');
                registerBtn.href = event.urlRegistro;
                registerBtn.target = '_blank';
                registerBtn.className = 'event-btn register';
                registerBtn.innerHTML = '<i>‚úçÔ∏è</i> Inscribirme';
                actions.appendChild(registerBtn);
            }
            
            // Bot√≥n de detalle
            const detailBtn = document.createElement('button');
            detailBtn.className = 'event-btn';
            detailBtn.innerHTML = '<i>üëÅÔ∏è</i> Ver detalles';
            detailBtn.addEventListener('click', () => showEventDetails(event));
            actions.appendChild(detailBtn);
            
            // Armar la tarjeta
            card.appendChild(titleContainer);
            card.appendChild(eventInfo);
            card.appendChild(actions);
            
            return card;
        }
        
        // Mostrar eventos de un d√≠a en un modal
        function showDayEvents(date, events) {
            // Actualizar t√≠tulo
            modalTitle.textContent = `Eventos para el ${formatDate(date)}`;
            
            // Limpiar contenido
            modalBody.innerHTML = '';
            
            // Ordenar eventos por hora
            const sortedEvents = [...events].sort((a, b) => {
                if (!a.horario || !b.horario) return 0;
                return a.horario.localeCompare(b.horario);
            });
            
            // Si no hay eventos
            if (sortedEvents.length === 0) {
                modalBody.innerHTML = '<div style="text-align:center; padding:10px; color:#666;">No hay eventos programados para este d√≠a.</div>';
            } else {
                // Crear elementos para cada evento
                sortedEvents.forEach(event => {
                    const eventItem = document.createElement('div');
                    eventItem.className = `event-card ${event.categoria}`;
                    eventItem.style.marginBottom = '10px';
                    
                    // T√≠tulo
                    const title = document.createElement('div');
                    title.className = 'event-card-title';
                    title.innerHTML = `
                        <span>${event.titulo}</span>
                        <span class="event-badge ${event.categoria}">${capitalizeFirstLetter(event.categoria)}</span>
                    `;
                    
                    // Informaci√≥n
                    const info = document.createElement('div');
                    info.className = 'event-info';
                    info.innerHTML = `
                        <div class="event-time"><i>‚è±Ô∏è</i> ${event.horario || 'Horario por definir'}</div>
                        <div class="event-location"><i>üìç</i> ${event.ubicacion || event.ubicaci√≥n || 'Ubicaci√≥n por definir'}</div>
                    `;
                    
                    // Descripci√≥n (si existe)
                    if (event.descripcion) {
                        const desc = document.createElement('div');
                        desc.style.margin = '10px 0';
                        desc.style.fontSize = '13px';
                        desc.style.color = '#444';
                        desc.textContent = event.descripcion;
                        info.appendChild(desc);
                    }
                    
                    // Acciones
                    const actions = document.createElement('div');
                    actions.className = 'event-actions';
                    actions.style.marginTop = '10px';
                    
                    // Bot√≥n de registro (si tiene URL)
                    if (event.urlRegistro && event.urlRegistro !== '#') {
                        const registerBtn = document.createElement('a');
                        registerBtn.href = event.urlRegistro;
                        registerBtn.target = '_blank';
                        registerBtn.className = 'event-btn register';
                        registerBtn.innerHTML = '<i>‚úçÔ∏è</i> Inscribirme';
                        actions.appendChild(registerBtn);
                    }
                    
                    // Bot√≥n para agregar a calendario
                    const calendarBtn = document.createElement('button');
                    calendarBtn.className = 'event-btn';
                    calendarBtn.innerHTML = '<i>üìÖ</i> Agregar a calendario';
                    calendarBtn.addEventListener('click', () => generateICS(event));
                    actions.appendChild(calendarBtn);
                    
                    eventItem.appendChild(title);
                    eventItem.appendChild(info);
                    eventItem.appendChild(actions);
                    
                    modalBody.appendChild(eventItem);
                });
            }
            
            // Mostrar modal
            eventModal.style.display = 'flex';
        }
        
        // Mostrar detalles de un evento
        function showEventDetails(event) {
            // Actualizar t√≠tulo
            modalTitle.textContent = event.titulo;
            
            // Limpiar contenido
            modalBody.innerHTML = '';
            
            // Crear contenido
            const content = document.createElement('div');
            
            // Badge de categor√≠a
            const categoryBadge = document.createElement('div');
            categoryBadge.className = `event-badge ${event.categoria}`;
            categoryBadge.style.marginBottom = '15px';
            categoryBadge.textContent = capitalizeFirstLetter(event.categoria);
            content.appendChild(categoryBadge);
            
            // Informaci√≥n b√°sica
            const basicInfo = document.createElement('div');
            basicInfo.style.marginBottom = '20px';
            
            // Fecha
            const dateInfo = document.createElement('div');
            dateInfo.style.marginBottom = '10px';
            dateInfo.innerHTML = `<strong>üìÖ Fecha:</strong> ${formatDate(event.fechaInicio)}`;
            
            // Si tiene fecha fin diferente, mostrarla
            if (event.fechaFin && !isSameDay(event.fechaInicio, event.fechaFin)) {
                dateInfo.innerHTML += ` - ${formatDate(event.fechaFin)}`;
            }
            
            basicInfo.appendChild(dateInfo);
            
            // Horario
            const timeInfo = document.createElement('div');
            timeInfo.style.marginBottom = '10px';
            timeInfo.innerHTML = `<strong>‚è±Ô∏è Horario:</strong> ${event.horario || 'No especificado'}`;
            basicInfo.appendChild(timeInfo);
            
            // Ubicaci√≥n
            const locationInfo = document.createElement('div');
            locationInfo.style.marginBottom = '10px';
            locationInfo.innerHTML = `<strong>üìç Ubicaci√≥n:</strong> ${event.ubicacion || event.ubicaci√≥n || 'No especificada'}`;
            basicInfo.appendChild(locationInfo);
            
            // Modalidad (si existe)
            if (event.modalidad) {
                const modalityInfo = document.createElement('div');
                modalityInfo.style.marginBottom = '10px';
                modalityInfo.innerHTML = `<strong>üîÑ Modalidad:</strong> ${event.modalidad}`;
                basicInfo.appendChild(modalityInfo);
            }
            
            // Duraci√≥n (si existe)
            if (event.duracion) {
                const durationInfo = document.createElement('div');
                durationInfo.style.marginBottom = '10px';
                durationInfo.innerHTML = `<strong>‚åõ Duraci√≥n:</strong> ${event.duracion}`;
                basicInfo.appendChild(durationInfo);
            }
            
            content.appendChild(basicInfo);
            
            // Descripci√≥n
            if (event.descripcion) {
                const descTitle = document.createElement('h4');
                descTitle.style.marginBottom = '10px';
                descTitle.style.color = '#333';
                descTitle.textContent = 'Descripci√≥n';
                content.appendChild(descTitle);
                
                const descText = document.createElement('p');
                descText.style.marginBottom = '20px';
                descText.style.color = '#444';
                descText.style.lineHeight = '1.5';
                descText.textContent = event.descripcion;
                content.appendChild(descText);
            }
            
            // Acciones
            const actions = document.createElement('div');
            actions.className = 'event-actions';
            actions.style.marginTop = '20px';
            
            // Bot√≥n de registro (si tiene URL)
            if (event.urlRegistro && event.urlRegistro !== '#') {
                const registerBtn = document.createElement('a');
                registerBtn.href = event.urlRegistro;
                registerBtn.target = '_blank';
                registerBtn.className = 'event-btn register';
                registerBtn.innerHTML = '<i>‚úçÔ∏è</i> Inscribirme';
                actions.appendChild(registerBtn);
            }
            
            // Bot√≥n para agregar a calendario
            const calendarBtn = document.createElement('button');
            calendarBtn.className = 'event-btn';
            calendarBtn.innerHTML = '<i>üìÖ</i> Agregar a calendario';
            calendarBtn.addEventListener('click', () => generateICS(event));
            actions.appendChild(calendarBtn);
            
            content.appendChild(actions);
            
            modalBody.appendChild(content);
            
            // Mostrar modal
            eventModal.style.display = 'flex';
        }
        
        // Generar archivo ICS para evento
        function generateICS(event) {
            try {
                // Crear fechas para el evento
                const startDate = event.fechaInicio;
                let endDate = event.fechaFin || new Date(startDate);
                
                // Si es el mismo d√≠a, agregar 1 hora por defecto
                if (isSameDay(startDate, endDate) && 
                    startDate.getHours() === endDate.getHours() && 
                    startDate.getMinutes() === endDate.getMinutes()) {
                    
                    // Intentar extraer hora del texto de horario
                    if (event.horario) {
                        const timeMatch = event.horario.match(/(\d{1,2}):(\d{2})/g);
                        
                        if (timeMatch && timeMatch.length >= 1) {
                            // Primer horario (inicio)
                            const [hour, minute] = timeMatch[0].split(':').map(Number);
                            startDate.setHours(hour, minute, 0);
                            
                            if (timeMatch.length >= 2) {
                                // Segundo horario (fin)
                                const [endHour, endMinute] = timeMatch[1].split(':').map(Number);
                                endDate.setHours(endHour, endMinute, 0);
                            } else {
                                // Si solo tenemos hora de inicio, agregar 1 hora
                                endDate = new Date(startDate);
                                endDate.setHours(endDate.getHours() + 1);
                            }
                        } else {
                            // Sin formato de hora reconocible, agregar 1 hora por defecto
                            endDate = new Date(startDate);
                            endDate.setHours(endDate.getHours() + 1);
                        }
                    } else {
                        // Sin informaci√≥n de horario, agregar 1 hora por defecto
                        endDate = new Date(startDate);
                        endDate.setHours(endDate.getHours() + 1);
                    }
                }
                
                // Formatear fechas para ICS
                const formatDateForICS = (date) => {
                    return date.toISOString().replace(/-|:|\.\d+/g, '');
                };
                
                // Crear contenido ICS
                const icsContent = [
                    'BEGIN:VCALENDAR',
                    'VERSION:2.0',
                    'PRODID:-//Consejer√≠a Emocional//Eventos//ES',
                    'CALSCALE:GREGORIAN',
                    'METHOD:PUBLISH',
                    'BEGIN:VEVENT',
                    `UID:${event.id || Math.random().toString(36).substring(2, 11)}@tecevents`,
                    `DTSTAMP:${formatDateForICS(new Date())}`,
                    `DTSTART:${formatDateForICS(startDate)}`,
                    `DTEND:${formatDateForICS(endDate)}`,
                    `SUMMARY:${event.titulo}`,
                    `DESCRIPTION:${event.descripcion || 'Sin descripci√≥n'}`,
                    `LOCATION:${event.ubicacion || event.ubicaci√≥n || 'No especificada'}`,
                    'END:VEVENT',
                    'END:VCALENDAR'
                ].join('\r\n');
                
                // Crear blob y URL
                const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                // Crear enlace y simular clic
                const link = document.createElement('a');
                link.href = url;
                link.download = `evento_${event.id || 'tec'}.ics`;
                document.body.appendChild(link);
                link.click();
                
                // Limpiar
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
                
                alert('Evento a√±adido a tu calendario');
            } catch (error) {
                console.error('Error generando archivo ICS:', error);
                alert('No se pudo generar el archivo para calendario');
            }
        }
        
        // Formatear fecha (DD de Mes, AAAA)
        function formatDate(date, includeYear = true) {
            if (!date) return 'Fecha no disponible';
            
            const day = date.getDate();
            const month = monthNames[date.getMonth()];
            const year = date.getFullYear();
            
            return includeYear ? `${day} de ${month}, ${year}` : `${day} de ${month}`;
        }
        
        // Formatear fecha para atributo data (YYYY-MM-DD)
        function formatDateForAttribute(date) {
            if (!date) return '';
            
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            
            return `${year}-${month}-${day}`;
        }
        
        // Capitalizar primera letra
        function capitalizeFirstLetter(string) {
            if (!string) return '';
            return string.charAt(0).toUpperCase() + string.slice(1);
        }
        
        // Cerrar modal
        function closeModal() {
            eventModal.style.display = 'none';
        }
        
        // Ir al mes anterior
        function goToPrevMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            generateCalendar();
        }
        
        // Ir al mes siguiente
        function goToNextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            generateCalendar();
        }
        
        // Ir al mes actual
        function goToToday() {
            const today = new Date();
            currentMonth = today.getMonth();
            currentYear = today.getFullYear();
            generateCalendar();
        }
    </script>
</body>
</html>
