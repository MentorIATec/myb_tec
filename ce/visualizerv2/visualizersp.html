<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventos - Consejer√≠a Emocional</title>
    <style>
        /* Variables y estilos base */
        :root {
            --color-primary: #0072CE;     /* Azul Tec */
            --color-primary-dark: #00509e;
            --color-secondary: #FF5800;   /* Naranja Tec */
            --color-light-bg: #f5f9ff;    /* Fondo claro con tinte azul */
            --color-light-border: #e0eaf9;
            --color-text-dark: #333;
            --color-text-medium: #4A5568;
            --color-background: #ffffff;
            
            /* Colores para categor√≠as */
            --color-curso: #0072CE;       /* Azul para cursos */
            --color-taller: #FF5800;      /* Naranja para talleres */
            --color-grupo: #9C27B0;       /* P√∫rpura para grupos */
            --color-activacion: #009688;  /* Verde azulado para activaciones */
            --color-evento: #FF9800;      /* Naranja/√°mbar para eventos */
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f8f8f8;
            color: var(--color-text-dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            padding: 10px;
            margin: 0 auto;
        }
        
        /* Componente de Calendario */
        .calendario-wrapper {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .calendario-header {
            background: var(--color-primary);
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .calendario-mes {
            font-size: 18px;
            font-weight: 600;
        }
        
        .calendario-controles {
            display: flex;
            gap: 8px;
        }
        
        .control-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .control-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Estilos de la vista de dos semanas */
        .semana-container {
            padding: 10px;
        }
        
        .semana-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-weight: 600;
            color: var(--color-text-medium);
            font-size: 13px;
            padding: 5px 0;
            background-color: var(--color-light-bg);
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .semana-dias {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin-bottom: 10px;
        }
        
        .dia {
            height: 80px; /* Altura fija para los d√≠as */
            border-radius: 8px;
            padding: 5px;
            background-color: white;
            border: 1px solid #eaeaea;
            display: flex;
            flex-direction: column;
            position: relative;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dia:hover {
            border-color: var(--color-primary);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .otro-mes {
            opacity: 0.5;
            background-color: #f8f8f8;
        }
        
        .dia-actual {
            border: 2px solid var(--color-secondary) !important;
            background-color: #fff9f5;
        }
        
        .dia-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }
        
        .numero-dia {
            font-weight: 600;
            font-size: 14px;
        }
        
        .dia-actual .numero-dia {
            color: var(--color-secondary);
        }
        
        .mes-badge {
            font-size: 9px;
            padding: 1px 3px;
            background: #f0f0f0;
            border-radius: 3px;
            color: #666;
        }
        
        .eventos-del-dia {
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex-grow: 1;
        }
        
        .evento-mini {
            font-size: 10px;
            padding: 2px 4px;
            border-radius: 3px;
            color: white;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
        }
        
        .evento-mini.curso { background-color: var(--color-curso); }
        .evento-mini.taller { background-color: var(--color-taller); }
        .evento-mini.grupo { background-color: var(--color-grupo); }
        .evento-mini.activacion { background-color: var(--color-activacion); }
        .evento-mini.evento { background-color: var(--color-evento); }
        
        .mas-eventos {
            font-size: 9px;
            text-align: center;
            background: #f0f0f0;
            border-radius: 3px;
            padding: 1px;
            margin-top: auto;
        }
        
        /* Lista de eventos */
        .eventos-proximos {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            margin-bottom: 15px;
        }
        
        .eventos-header {
            background: var(--color-primary);
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .eventos-titulo {
            font-size: 16px;
            font-weight: 600;
        }
        
        .contador-eventos {
            background: rgba(255,255,255,0.2);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
        }
        
        .eventos-content {
            padding: 10px;
        }
        
        .evento-item {
            border-left: 3px solid var(--color-primary);
            padding: 10px;
            margin-bottom: 10px;
            background: #f8f8f8;
            border-radius: 5px;
        }
        
        .evento-item:last-child {
            margin-bottom: 0;
        }
        
        .evento-item.curso { border-left-color: var(--color-curso); }
        .evento-item.taller { border-left-color: var(--color-taller); }
        .evento-item.grupo { border-left-color: var(--color-grupo); }
        .evento-item.activacion { border-left-color: var(--color-activacion); }
        .evento-item.evento { border-left-color: var(--color-evento); }
        
        .evento-fecha {
            font-size: 11px;
            color: #666;
        }
        
        .evento-titulo {
            font-weight: 600;
            font-size: 14px;
            margin: 3px 0;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .evento-item.curso .evento-titulo { color: var(--color-curso); }
        .evento-item.taller .evento-titulo { color: var(--color-taller); }
        .evento-item.grupo .evento-titulo { color: var(--color-grupo); }
        .evento-item.activacion .evento-titulo { color: var(--color-activacion); }
        .evento-item.evento .evento-titulo { color: var(--color-evento); }
        
        .evento-badge {
            font-size: 9px;
            padding: 2px 5px;
            border-radius: 10px;
            text-transform: uppercase;
            font-weight: 500;
            color: white;
        }
        
        .evento-badge.curso { background-color: var(--color-curso); }
        .evento-badge.taller { background-color: var(--color-taller); }
        .evento-badge.grupo { background-color: var(--color-grupo); }
        .evento-badge.activacion { background-color: var(--color-activacion); }
        .evento-badge.evento { background-color: var(--color-evento); }
        
        .evento-detalles {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 5px;
            font-size: 12px;
            color: #555;
        }
        
        .evento-horario, .evento-ubicacion {
            display: flex;
            align-items: center;
            gap: 3px;
        }
        
        .evento-acciones {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 8px;
        }
        
        .evento-btn {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 3px;
            text-decoration: none;
            transition: background 0.2s;
            background: var(--color-primary);
            color: white;
        }
        
        .evento-btn:hover {
            background: var(--color-primary-dark);
        }
        
        .evento-btn.registro {
            background: var(--color-secondary);
        }
        
        .evento-btn.registro:hover {
            background: #D94500;
        }
        
        /* Modal para eventos */
        .modal-eventos {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            padding: 15px;
            border-bottom: 1px solid #eee;
            position: relative;
        }
        
        .modal-title {
            font-size: 18px;
            color: var(--color-primary);
            margin-right: 20px;
        }
        
        .modal-close {
            position: absolute;
            right: 15px;
            top: 15px;
            font-size: 20px;
            cursor: pointer;
            color: #777;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }
        
        .modal-close:hover {
            background: #f0f0f0;
        }
        
        .modal-body {
            padding: 15px;
        }
        
        /* Leyenda */
        .leyenda {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            font-size: 12px;
            margin-top: 10px;
            margin-bottom: 10px;
            background: white;
            padding: 8px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .leyenda-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #555;
        }
        
        .leyenda-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        
        .leyenda-color.curso { background-color: var(--color-curso); }
        .leyenda-color.taller { background-color: var(--color-taller); }
        .leyenda-color.grupo { background-color: var(--color-grupo); }
        .leyenda-color.activacion { background-color: var(--color-activacion); }
        .leyenda-color.evento { background-color: var(--color-evento); }
        
        /* Estados de carga y mensajes */
        .loading-container {
            padding: 30px;
            text-align: center;
            color: #666;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f0f0f0;
            border-radius: 50%;
            border-top-color: var(--color-primary);
            margin: 0 auto 15px;
            animation: spinner 0.8s linear infinite;
        }
        
        @keyframes spinner {
            to { transform: rotate(360deg); }
        }
        
        .mensaje-error {
            padding: 15px;
            background: #fff5f5;
            border-left: 3px solid #d32f2f;
            color: #d32f2f;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        
        .mensaje-vacio {
            padding: 15px;
            text-align: center;
            color: #666;
            background: #f8f8f8;
            border-radius: 5px;
            font-style: italic;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .semana-dias {
                gap: 4px;
            }
            
            .dia {
                height: 70px;
                padding: 4px;
            }
            
            .evento-mini {
                font-size: 9px;
                padding: 1px 3px;
            }
            
            .numero-dia {
                font-size: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 5px;
            }
            
            .semana-header {
                font-size: 10px;
            }
            
            .semana-dias {
                gap: 3px;
            }
            
            .dia {
                height: 60px;
                padding: 3px;
            }
            
            .numero-dia {
                font-size: 11px;
            }
            
            .calendario-mes {
                font-size: 15px;
            }
            
            .evento-mini {
                font-size: 8px;
                padding: 1px 2px;
            }
            
            .leyenda {
                font-size: 10px;
            }
            
            .leyenda-color {
                width: 10px;
                height: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Calendario de dos semanas -->
        <div class="calendario-wrapper">
            <div class="calendario-header">
                <div class="calendario-mes" id="periodo-texto">Marzo 24 - Abril 6, 2025</div>
                <div class="calendario-controles">
                    <button class="control-btn" id="semana-anterior">&lt;</button>
                    <button class="control-btn" id="hoy">Hoy</button>
                    <button class="control-btn" id="semana-siguiente">&gt;</button>
                </div>
            </div>
            
            <div class="semana-container" id="calendario-contenedor">
                <div class="semana-header">
                    <div>DOM</div>
                    <div>LUN</div>
                    <div>MAR</div>
                    <div>MI√â</div>
                    <div>JUE</div>
                    <div>VIE</div>
                    <div>S√ÅB</div>
                </div>
                
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div>Cargando eventos...</div>
                </div>
            </div>
        </div>
        
        <!-- Leyenda de colores -->
        <div class="leyenda">
            <div class="leyenda-item">
                <div class="leyenda-color curso"></div>
                <span>Cursos</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-color taller"></div>
                <span>Talleres</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-color grupo"></div>
                <span>Grupos</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-color activacion"></div>
                <span>Activaciones</span>
            </div>
            <div class="leyenda-item">
                <div class="leyenda-color evento"></div>
                <span>Eventos</span>
            </div>
        </div>
        
        <!-- Lista de eventos pr√≥ximos -->
        <div class="eventos-proximos">
            <div class="eventos-header">
                <div class="eventos-titulo">Eventos pr√≥ximos</div>
                <div class="contador-eventos" id="contador-eventos">0 eventos</div>
            </div>
            
            <div class="eventos-content" id="eventos-lista">
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <div>Cargando eventos...</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para eventos del d√≠a -->
    <div class="modal-eventos" id="modal-eventos">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-titulo">Eventos del d√≠a</h3>
                <span class="modal-close" id="modal-cerrar">&times;</span>
            </div>
            <div class="modal-body" id="modal-contenido">
                <!-- Contenido del modal se llenar√° din√°micamente -->
            </div>
        </div>
    </div>
    
    <script>
        // Variables globales
        let todosLosEventos = [];
        let fechaActual = new Date();
        let fechaInicioPeriodo = new Date();
        
        // URL del archivo JSON de eventos
        const URL_EVENTOS = 'https://karenguzmn.github.io/myb_tec/ce/eventos.json';
        
        // Nombres de los meses
        const MESES = [
            'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
            'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
        ];
        
        // Nombres de los d√≠as de la semana
        const DIAS_SEMANA = ['DOM', 'LUN', 'MAR', 'MI√â', 'JUE', 'VIE', 'S√ÅB'];
        
        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', inicializar);
        
        // Funci√≥n principal de inicializaci√≥n
        function inicializar() {
            // Configurar fecha de inicio (domingo de la semana actual)
            configurarFechaInicio();
            
            // Cargar eventos
            cargarEventos();
            
            // Configurar listeners de navegaci√≥n
            document.getElementById('semana-anterior').addEventListener('click', irSemanasAtras);
            document.getElementById('semana-siguiente').addEventListener('click', irSemanasSiguientes);
            document.getElementById('hoy').addEventListener('click', irAHoy);
            
            // Configurar modal
            document.getElementById('modal-cerrar').addEventListener('click', cerrarModal);
            document.getElementById('modal-eventos').addEventListener('click', function(e) {
                if (e.target === this) cerrarModal();
            });
            
            // Cerrar modal con Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') cerrarModal();
            });
        }
        
        // Configura la fecha de inicio para que sea el domingo de la semana actual
        function configurarFechaInicio() {
            fechaInicioPeriodo = new Date(fechaActual);
            const diaSemana = fechaInicioPeriodo.getDay(); // 0: domingo, 6: s√°bado
            fechaInicioPeriodo.setDate(fechaInicioPeriodo.getDate() - diaSemana);
        }
        
        // Cargar eventos desde JSON
        function cargarEventos() {
            fetch(URL_EVENTOS)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    todosLosEventos = data.eventos || [];
                    
                    // Procesar eventos para facilitar su manejo
                    todosLosEventos.forEach(evento => {
                        evento.fechaInicio = parsearFecha(evento.fechaInicio);
                        evento.fechaFin = parsearFecha(evento.fechaFin || evento.fechaInicio);
                        evento.categoria = normalizarCategoria(evento.categoria);
                    });
                    
                    // Generar vista de dos semanas
                    generarCalendarioDosSemanasDesde(fechaInicioPeriodo);
                    
                    // Mostrar eventos pr√≥ximos
                    mostrarEventosProximos();
                })
                .catch(error => {
                    console.error('Error al cargar eventos:', error);
                    mostrarError('No se pudieron cargar los eventos. Intenta m√°s tarde.');
                });
        }
        
        // Parsear fecha de formato DD/MM/YYYY a objeto Date
        function parsearFecha(fechaStr) {
            if (!fechaStr) return null;
            
            // Si ya es un objeto Date, devolverlo
            if (fechaStr instanceof Date) return fechaStr;
            
            try {
                if (typeof fechaStr === 'string' && fechaStr.includes('/')) {
                    const partes = fechaStr.split('/');
                    if (partes.length === 3) {
                        // En el formato DD/MM/YYYY
                        return new Date(
                            parseInt(partes[2]), // a√±o
                            parseInt(partes[1]) - 1, // mes (0-11)
                            parseInt(partes[0]) // d√≠a
                        );
                    }
                }
                
                // Si no es el formato esperado, intentar como fecha normal
                return new Date(fechaStr);
            } catch (error) {
                console.error('Error al parsear fecha:', error);
                return null;
            }
        }
        
        // Normalizar categor√≠as de eventos
        function normalizarCategoria(categoria) {
            if (!categoria) return 'otro';
            
            const cat = categoria.toLowerCase();
            
            if (cat.includes('taller')) return 'taller';
            if (cat.includes('curso')) return 'curso';
            if (cat.includes('grupo')) return 'grupo';
            if (cat.includes('activacion') || cat.includes('activaci√≥n')) return 'activacion';
            if (cat.includes('evento')) return 'evento';
            
            return 'otro';
        }
        
        // Formatear fecha para mostrar
        function formatearFecha(fecha, incluirAno = true) {
            if (!fecha) return '';
            
            const dia = fecha.getDate();
            const mes = MESES[fecha.getMonth()];
            const ano = fecha.getFullYear();
            
            return incluirAno ? `${dia} de ${mes}, ${ano}` : `${dia} de ${mes}`;
        }
        
        // Formatear fecha corta (DD/MM)
        function formatearFechaCorta(fecha) {
            if (!fecha) return '';
            
            const dia = fecha.getDate();
            const mes = fecha.getMonth() + 1;
            
            return `${dia}/${mes}`;
        }
        
        // Generar vista de dos semanas a partir de una fecha
        function generarCalendarioDosSemanasDesde(fechaInicio) {
            const calendarioContenedor = document.getElementById('calendario-contenedor');
            
            // Conservar el encabezado de la semana
            const encabezadoSemana = calendarioContenedor.querySelector('.semana-header');
            calendarioContenedor.innerHTML = '';
            if (encabezadoSemana) calendarioContenedor.appendChild(encabezadoSemana);
            
            // Calcular fecha fin del per√≠odo (14 d√≠as despu√©s)
            const fechaFin = new Date(fechaInicio);
            fechaFin.setDate(fechaInicio.getDate() + 13); // 2 semanas - 1 d√≠a
            
            // Actualizar t√≠tulo del per√≠odo
            actualizarTituloPeriodo(fechaInicio, fechaFin);
            
            // Generar las dos semanas
            for (let semana = 0; semana < 2; semana++) {
                const semanaNodo = document.createElement('div');
                semanaNodo.className = 'semana-dias';
                
                for (let dia = 0; dia < 7; dia++) {
                    const fechaDia = new Date(fechaInicio);
                    fechaDia.setDate(fechaInicio.getDate() + (semana * 7) + dia);
                    
                    // Crear el elemento del d√≠a
                    const diaElemento = generarDia(fechaDia);
                    semanaNodo.appendChild(diaElemento);
                }
                
                calendarioContenedor.appendChild(semanaNodo);
            }
        }
        
        // Generar un d√≠a para el calendario
        function generarDia(fecha) {
            const hoy = new Date();
            const esHoy = esMismaFecha(fecha, hoy);
            const esOtroMes = fecha.getMonth() !== fechaActual.getMonth();
            
            // Obtener eventos para este d√≠a
            const eventosDelDia = obtenerEventosDelDia(fecha);
            
            // Crear elemento del d√≠a
            const diaElemento = document.createElement('div');
            diaElemento.className = 'dia';
            if (esHoy) diaElemento.classList.add('dia-actual');
            if (esOtroMes) diaElemento.classList.add('otro-mes');
            
            // A√±adir atributos de datos
            diaElemento.setAttribute('data-fecha', 
                `${fecha.getFullYear()}-${fecha.getMonth()+1}-${fecha.getDate()}`);
            
            // Encabezado del d√≠a (n√∫mero + indicador de mes si es otro mes)
            const diaHeader = document.createElement('div');
            diaHeader.className = 'dia-header';
            
            const numeroDia = document.createElement('div');
            numeroDia.className = 'numero-dia';
            numeroDia.textContent = fecha.getDate();
            diaHeader.appendChild(numeroDia);
            
            // Si es otro mes, mostrar indicador
            if (esOtroMes) {
                const mesBadge = document.createElement('div');
                mesBadge.className = 'mes-badge';
                mesBadge.textContent = MESES[fecha.getMonth()].substring(0, 3);
                diaHeader.appendChild(mesBadge);
            }
            
            diaElemento.appendChild(diaHeader);
            
            // Contenedor de eventos
            const eventosContainer = document.createElement('div');
            eventosContainer.className = 'eventos-del-dia';
            
            // Mostrar hasta 3 eventos
            const maxEventosMostrados = 3;
            let eventosRestantes = 0;
            
            if (eventosDelDia.length > 0) {
                // Ordenar por hora
                eventosDelDia.sort((a, b) => {
                    if (!a.horario || !b.horario) return 0;
                    return a.horario.localeCompare(b.horario);
                });
                
                // Mostrar hasta maxEventosMostrados
                const eventosAMostrar = eventosDelDia.slice(0, maxEventosMostrados);
                eventosRestantes = eventosDelDia.length - maxEventosMostrados;
                
                eventosAMostrar.forEach(evento => {
                    const eventoMini = document.createElement('div');
                    eventoMini.className = `evento-mini ${evento.categoria}`;
                    eventoMini.textContent = evento.titulo;
                    eventosContainer.appendChild(eventoMini);
                });
                
                // Si hay m√°s eventos, mostrar indicador
                if (eventosRestantes > 0) {
                    const masEventos = document.createElement('div');
                    masEventos.className = 'mas-eventos';
                    masEventos.textContent = `+${eventosRestantes} m√°s`;
                    eventosContainer.appendChild(masEventos);
                }
                
                // A√±adir evento de clic para mostrar todos los eventos del d√≠a
                diaElemento.addEventListener('click', () => {
                    mostrarEventosModal(fecha, eventosDelDia);
                });
            }
            
            diaElemento.appendChild(eventosContainer);
            
            return diaElemento;
        }
        
        // Actualizar el t√≠tulo del per√≠odo
        function actualizarTituloPeriodo(fechaInicio, fechaFin) {
            let titulo = '';
            
            if (fechaInicio.getMonth() === fechaFin.getMonth()) {
                // Mismo mes
                titulo = `${MESES[fechaInicio.getMonth()]} ${fechaInicio.getDate()} - ${fechaFin.getDate()}, ${fechaInicio.getFullYear()}`;
            } else {
                // Meses diferentes
                titulo = `${MESES[fechaInicio.getMonth()]} ${fechaInicio.getDate()} - ${MESES[fechaFin.getMonth()]} ${fechaFin.getDate()}, ${fechaInicio.getFullYear()}`;
            }
            
            document.getElementById('periodo-texto').textContent = titulo;
        }
        
        // Obtener eventos para un d√≠a espec√≠fico
        function obtenerEventosDelDia(fecha) {
            if (!fecha || !todosLosEventos || todosLosEventos.length === 0) return [];
            
            return todosLosEventos.filter(evento => {
                if (!evento.fechaInicio) return false;
                
                // Verificar si el evento ocurre en esta fecha
                return esMismaFecha(evento.fechaInicio, fecha) || 
                       esMismaFecha(evento.fechaFin, fecha) || 
                       (evento.fechaInicio < fecha && evento.fechaFin > fecha);
            });
        }
        
        // Verificar si dos fechas son el mismo d√≠a
        function esMismaFecha(fecha1, fecha2) {
            if (!fecha1 || !fecha2) return false;
            
            return fecha1.getDate() === fecha2.getDate() &&
                   fecha1.getMonth() === fecha2.getMonth() &&
                   fecha1.getFullYear() === fecha2.getFullYear();
        }
        
        // Mostrar eventos pr√≥ximos
        function mostrarEventosProximos() {
            const eventosLista = document.getElementById('eventos-lista');
            
            // Obtener la fecha actual (inicio del d√≠a)
            const hoy = new Date();
            hoy.setHours(0, 0, 0, 0);
            
            // Filtrar eventos futuros
            const eventosFuturos = todosLosEventos.filter(evento => {
                if (!evento.fechaInicio) return false;
                return evento.fechaInicio >= hoy;
            });
            
            // Ordenar por fecha
            eventosFuturos.sort((a, b) => a.fechaInicio - b.fechaInicio);
            
            // Actualizar contador
            document.getElementById('contador-eventos').textContent = `${eventosFuturos.length} eventos`;
            
            // Verificar si hay eventos
            if (eventosFuturos.length === 0) {
                eventosLista.innerHTML = '<div class="mensaje-vacio">No hay eventos pr√≥ximos programados.</div>';
                return;
            }
            
            // Mostrar hasta 5 eventos pr√≥ximos
            eventosLista.innerHTML = '';
            const eventosAMostrar = eventosFuturos.slice(0, 5);
            
            eventosAMostrar.forEach(evento => {
                eventosLista.appendChild(crearEventoItem(evento));
            });
        }
        
        // Crear un elemento de evento para la lista
        function crearEventoItem(evento) {
            const eventoItem = document.createElement('div');
            eventoItem.className = `evento-item ${evento.categoria}`;
            
            // Fecha formateada
            const fechaTexto = document.createElement('div');
            fechaTexto.className = 'evento-fecha';
            fechaTexto.textContent = formatearFecha(evento.fechaInicio);
            
            // T√≠tulo y badge
            const tituloContainer = document.createElement('div');
            tituloContainer.className = 'evento-titulo';
            
            const titulo = document.createElement('span');
            titulo.textContent = evento.titulo;
            
            const badge = document.createElement('span');
            badge.className = `evento-badge ${evento.categoria}`;
            badge.textContent = capitalizarPrimera(evento.categoria);
            
            tituloContainer.appendChild(titulo);
            tituloContainer.appendChild(badge);
            
            // Detalles (horario y ubicaci√≥n)
            const detalles = document.createElement('div');
            detalles.className = 'evento-detalles';
            
            const horario = document.createElement('div');
            horario.className = 'evento-horario';
            horario.innerHTML = `<span>‚è±Ô∏è</span> ${evento.horario || 'Horario por definir'}`;
            
            const ubicacion = document.createElement('div');
            ubicacion.className = 'evento-ubicacion';
            ubicacion.innerHTML = `<span>üìç</span> ${evento.ubicacion || evento.ubicaci√≥n || 'Ubicaci√≥n por definir'}`;
            
            detalles.appendChild(horario);
            detalles.appendChild(ubicacion);
            
            // Acciones (botones)
            const acciones = document.createElement('div');
            acciones.className = 'evento-acciones';
            
            // Bot√≥n de registro (si tiene URL)
            if (evento.urlRegistro && evento.urlRegistro !== '#') {
                const btnRegistro = document.createElement('a');
                btnRegistro.href = evento.urlRegistro;
                btnRegistro.target = '_blank';
                btnRegistro.className = 'evento-btn registro';
                btnRegistro.innerHTML = '<span>‚úçÔ∏è</span> Inscribirme';
                acciones.appendChild(btnRegistro);
            }
            
            // Bot√≥n para agregar a calendario
            const btnCalendario = document.createElement('button');
            btnCalendario.className = 'evento-btn';
            btnCalendario.innerHTML = '<span>üìÖ</span> Agregar a calendario';
            btnCalendario.addEventListener('click', () => {
                generarICS(evento);
            });
            acciones.appendChild(btnCalendario);
            
            // Armar el evento completo
            eventoItem.appendChild(fechaTexto);
            eventoItem.appendChild(tituloContainer);
            eventoItem.appendChild(detalles);
            eventoItem.appendChild(acciones);
            
            return eventoItem;
        }
        
        // Mostrar modal con eventos de un d√≠a
        function mostrarEventosModal(fecha, eventos) {
            // Actualizar t√≠tulo
            document.getElementById('modal-titulo').textContent = 
                `Eventos para el ${formatearFecha(fecha)}`;
            
            // Contenido del modal
            const modalContenido = document.getElementById('modal-contenido');
            modalContenido.innerHTML = '';
            
            // Verificar si hay eventos
            if (!eventos || eventos.length === 0) {
                modalContenido.innerHTML = '<div class="mensaje-vacio">No hay eventos para este d√≠a.</div>';
            } else {
                // Ordenar eventos por hora
                eventos.sort((a, b) => {
                    if (!a.horario || !b.horario) return 0;
                    return a.horario.localeCompare(b.horario);
                });
                
                // Crear elementos para cada evento
                eventos.forEach(evento => {
                    modalContenido.appendChild(crearEventoItemModal(evento));
                });
            }
            
            // Mostrar modal
            document.getElementById('modal-eventos').style.display = 'flex';
        }
        
        // Crear elemento de evento para el modal
        function crearEventoItemModal(evento) {
            const eventoItem = document.createElement('div');
            eventoItem.className = `evento-item ${evento.categoria}`;
            
            // T√≠tulo y badge
            const tituloContainer = document.createElement('div');
            tituloContainer.className = 'evento-titulo';
            
            const titulo = document.createElement('span');
            titulo.textContent = evento.titulo;
            
            const badge = document.createElement('span');
            badge.className = `evento-badge ${evento.categoria}`;
            badge.textContent = capitalizarPrimera(evento.categoria);
            
            tituloContainer.appendChild(titulo);
            tituloContainer.appendChild(badge);
            
            // Detalles (horario y ubicaci√≥n)
            const detalles = document.createElement('div');
            detalles.className = 'evento-detalles';
            
            const horario = document.createElement('div');
            horario.className = 'evento-horario';
            horario.innerHTML = `<span>‚è±Ô∏è</span> ${evento.horario || 'Horario por definir'}`;
            
            const ubicacion = document.createElement('div');
            ubicacion.className = 'evento-ubicacion';
            ubicacion.innerHTML = `<span>üìç</span> ${evento.ubicacion || evento.ubicaci√≥n || 'Ubicaci√≥n por definir'}`;
            
            detalles.appendChild(horario);
            detalles.appendChild(ubicacion);
            
            // Descripci√≥n
            if (evento.descripcion) {
                const descripcion = document.createElement('div');
                descripcion.className = 'evento-descripcion';
                descripcion.style.marginTop = '10px';
                descripcion.style.fontSize = '13px';
                descripcion.style.color = '#444';
                descripcion.textContent = evento.descripcion;
                detalles.appendChild(descripcion);
            }
            
            // Modalidad
            if (evento.modalidad) {
                const modalidad = document.createElement('div');
                modalidad.className = 'evento-modalidad';
                modalidad.style.marginTop = '8px';
                modalidad.style.fontSize = '12px';
                modalidad.innerHTML = `<strong>Modalidad:</strong> ${evento.modalidad}`;
                detalles.appendChild(modalidad);
            }
            
            // Duraci√≥n
            if (evento.duracion) {
                const duracion = document.createElement('div');
                duracion.className = 'evento-duracion';
                duracion.style.marginTop = '5px';
                duracion.style.fontSize = '12px';
                duracion.innerHTML = `<strong>Duraci√≥n:</strong> ${evento.duracion}`;
                detalles.appendChild(duracion);
            }
            
            // Acciones (botones)
            const acciones = document.createElement('div');
            acciones.className = 'evento-acciones';
            acciones.style.marginTop = '15px';
            
            // Bot√≥n de registro (si tiene URL)
            if (evento.urlRegistro && evento.urlRegistro !== '#') {
                const btnRegistro = document.createElement('a');
                btnRegistro.href = evento.urlRegistro;
                btnRegistro.target = '_blank';
                btnRegistro.className = 'evento-btn registro';
                btnRegistro.innerHTML = '<span>‚úçÔ∏è</span> Inscribirme';
                acciones.appendChild(btnRegistro);
            }
            
            // Bot√≥n para agregar a calendario
            const btnCalendario = document.createElement('button');
            btnCalendario.className = 'evento-btn';
            btnCalendario.innerHTML = '<span>üìÖ</span> Agregar a calendario';
            btnCalendario.addEventListener('click', () => {
                generarICS(evento);
            });
            acciones.appendChild(btnCalendario);
            
            // Armar el evento completo
            eventoItem.appendChild(tituloContainer);
            eventoItem.appendChild(detalles);
            eventoItem.appendChild(acciones);
            
            return eventoItem;
        }
        
        // Generar y descargar archivo ICS para un evento
        function generarICS(evento) {
            try {
                // Crear fechas para el evento
                const fechaInicio = evento.fechaInicio;
                let fechaFin = evento.fechaFin || new Date(fechaInicio);
                
                // Si es el mismo d√≠a, agregar 1 hora por defecto a menos que tenga informaci√≥n de hora
                if (esMismaFecha(fechaInicio, fechaFin) && 
                    fechaInicio.getHours() === fechaFin.getHours() && 
                    fechaInicio.getMinutes() === fechaFin.getMinutes()) {
                    
                    // Intentar extraer hora del texto de horario
                    let horaInicio, minutoInicio, horaFin, minutoFin;
                    
                    if (evento.horario) {
                        const horasMatch = evento.horario.match(/(\d{1,2}):(\d{2})/g);
                        
                        if (horasMatch && horasMatch.length >= 1) {
                            // Primer horario (inicio)
                            const [horaStr, minutoStr] = horasMatch[0].split(':').map(Number);
                            horaInicio = horaStr;
                            minutoInicio = minutoStr;
                            
                            // Establecer la hora de inicio
                            fechaInicio.setHours(horaInicio, minutoInicio, 0);
                        }
                        
                        if (horasMatch && horasMatch.length >= 2) {
                            // Segundo horario (fin)
                            const [horaStr, minutoStr] = horasMatch[1].split(':').map(Number);
                            horaFin = horaStr;
                            minutoFin = minutoStr;
                            
                            // Establecer la hora de fin
                            fechaFin.setHours(horaFin, minutoFin, 0);
                        } else if (horaInicio !== undefined) {
                            // Si solo tenemos hora de inicio, a√±adir 1 hora por defecto
                            fechaFin = new Date(fechaInicio);
                            fechaFin.setHours(fechaInicio.getHours() + 1);
                        }
                    } else {
                        // Sin informaci√≥n de horario, a√±adir 1 hora por defecto
                        fechaFin = new Date(fechaInicio);
                        fechaFin.setHours(fechaInicio.getHours() + 1);
                    }
                }
                
                // Formatear fechas para ICS
                const formatoFechaICS = function(fecha) {
                    return fecha.toISOString().replace(/-|:|\.\d+/g, '');
                };
                
                // Crear contenido ICS
                const contenidoICS = [
                    'BEGIN:VCALENDAR',
                    'VERSION:2.0',
                    'PRODID:-//Consejer√≠a Emocional//Eventos//ES',
                    'CALSCALE:GREGORIAN',
                    'METHOD:PUBLISH',
                    'BEGIN:VEVENT',
                    `UID:${evento.id}@visualizador-eventos`,
                    `DTSTAMP:${formatoFechaICS(new Date())}`,
                    `DTSTART:${formatoFechaICS(fechaInicio)}`,
                    `DTEND:${formatoFechaICS(fechaFin)}`,
                    `SUMMARY:${evento.titulo}`,
                    `DESCRIPTION:${evento.descripcion || 'Sin descripci√≥n'}`,
                    `LOCATION:${evento.ubicacion || evento.ubicaci√≥n || 'Por definir'}`,
                    'END:VEVENT',
                    'END:VCALENDAR'
                ].join('\r\n');
                
                // Crear blob y URL
                const blob = new Blob([contenidoICS], { type: 'text/calendar;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                // Crear enlace y simular clic
                const link = document.createElement('a');
                link.href = url;
                link.download = `evento_${evento.id}.ics`;
                document.body.appendChild(link);
                link.click();
                
                // Limpiar
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
                
                // Mostrar confirmaci√≥n
                alert('Evento a√±adido a tu calendario');
            } catch (error) {
                console.error('Error al generar calendario:', error);
                alert('Error al generar el archivo de calendario');
            }
        }
        
        // Cerrar modal
        function cerrarModal() {
            document.getElementById('modal-eventos').style.display = 'none';
        }
        
        // Mostrar mensaje de error
        function mostrarError(mensaje) {
            const calendarioContenedor = document.getElementById('calendario-contenedor');
            const eventosLista = document.getElementById('eventos-lista');
            
            // Mostrar error en calendario
            calendarioContenedor.innerHTML = `
                <div class="mensaje-error">${mensaje}</div>
            `;
            
            // Mostrar error en lista de eventos
            eventosLista.innerHTML = `
                <div class="mensaje-error">${mensaje}</div>
            `;
        }
        
        // Navegar a semanas anteriores
        function irSemanasAtras() {
            fechaInicioPeriodo.setDate(fechaInicioPeriodo.getDate() - 14);
            generarCalendarioDosSemanasDesde(fechaInicioPeriodo);
        }
        
        // Navegar a semanas siguientes
        function irSemanasSiguientes() {
            fechaInicioPeriodo.setDate(fechaInicioPeriodo.getDate() + 14);
            generarCalendarioDosSemanasDesde(fechaInicioPeriodo);
        }
        
        // Ir a la semana actual
        function irAHoy() {
            fechaActual = new Date();
            configurarFechaInicio();
            generarCalendarioDosSemanasDesde(fechaInicioPeriodo);
        }
        
        // Capitalizar primera letra
        function capitalizarPrimera(texto) {
            if (!texto) return '';
            return texto.charAt(0).toUpperCase() + texto.slice(1).toLowerCase();
        }
    </script>
</body>
</html>
